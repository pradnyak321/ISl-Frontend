<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Learning Feedback Form</title>

  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/css/main.css" rel="stylesheet">
  <style>
    /* Popup styling */
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 1000;
    }

    .popup .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .popup .popup-header h4 {
      margin: 0;
    }

    .popup .popup-header .close-btn {
      font-size: 24px;
      cursor: pointer;
    }

    .popup-buttons {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 999;
    }

    .confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    /* Emoji Rating Styling */
    .rating-container {
      margin-bottom: 20px;
    }

    .rating-label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .rating-options input {
      display: none;
    }

    .rating-options label {
      cursor: pointer;
      font-size: 1.5rem;
      margin-right: 10px;
      transition: transform 0.3s, border 0.3s;
      padding: 5px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 2px solid transparent;
    }

    .rating-options input:checked+label {
      transform: scale(1.4);
      border-color: #007bff;
    }
  </style>
</head>

<body class="course-details-page">
  <!-- Header Section -->
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo">
        <h1 class="sitename">ISL Mate</h1>
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html?lang=mr">Home</a></li>
          <li><a href="about.html?lang=mr">About</a></li>
          <li><a href="menu.html?lang=mr" class="active">Menu</a></li>
          <li><a href="contact.html?lang=mr">Contact</a></li>
          <li><a href="student.html?lang=mr" class="active" id="student-btn">Student</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
    </div>
  </header>

  <!-- Google Translate Widget -->
  <div id="google_translate_element" style="position: fixed; top: 10px; right: 10px; z-index: 1000; background: #f9f9f9; border: 1px solid #ddd; padding: 5px; border-radius: 5px;"></div>
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'mr,en',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- Main Content -->
  <main class="main">
    <div class="page-title" data-aos="fade">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1>Learning Feedback Form</h1>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Feedback Form Section -->
    <section class="container">
      <form id="feedback-form">
        <input type="hidden" name="formType" value="learning">

        <!-- Hidden fields for formType and userType -->
        <input type="hidden" name="formType" value="Learning Feedback">
        <input type="hidden" name="userType" value="Student">
  
        <!-- Emoji Ratings -->
        <div class="rating-container">
          <label class="rating-label">1. How would you rate your learning experience?</label>
          <div class="rating-options">
            <input type="radio" id="rating-1" name="learningExperience" value="1" required>
            <label for="rating-1">ğŸ˜</label>
            <input type="radio" id="rating-2" name="learningExperience" value="2">
            <label for="rating-2">ğŸ˜</label>
            <input type="radio" id="rating-3" name="learningExperience" value="3">
            <label for="rating-3">ğŸ™‚</label>
            <input type="radio" id="rating-4" name="learningExperience" value="4">
            <label for="rating-4">ğŸ˜Š</label>
            <input type="radio" id="rating-5" name="learningExperience" value="5">
            <label for="rating-5">ğŸ˜</label>
          </div>
        </div>

        <div class="rating-container">
          <label class="rating-label">2. How useful do you find the ISLMate platform?</label>
          <div class="rating-options">
            <input type="radio" id="useful-1" name="platformUsefulness" value="1" required>
            <label for="useful-1">ğŸ˜</label>
            <input type="radio" id="useful-2" name="platformUsefulness" value="2">
            <label for="useful-2">ğŸ˜</label>
            <input type="radio" id="useful-3" name="platformUsefulness" value="3">
            <label for="useful-3">ğŸ™‚</label>
            <input type="radio" id="useful-4" name="platformUsefulness" value="4">
            <label for="useful-4">ğŸ˜Š</label>
            <input type="radio" id="useful-5" name="platformUsefulness" value="5">
            <label for="useful-5">ğŸ˜</label>
          </div>
        </div>

        <div class="rating-container">
          <label class="rating-label">3. How interactive is the ISLMate platform?</label>
          <div class="rating-options">
            <input type="radio" id="interactive-1" name="platformInteractivity" value="1" required>
            <label for="interactive-1">ğŸ˜</label>
            <input type="radio" id="interactive-2" name="platformInteractivity" value="2">
            <label for="interactive-2">ğŸ˜</label>
            <input type="radio" id="interactive-3" name="platformInteractivity" value="3">
            <label for="interactive-3">ğŸ™‚</label>
            <input type="radio" id="interactive-4" name="platformInteractivity" value="4">
            <label for="interactive-4">ğŸ˜Š</label>
            <input type="radio" id="interactive-5" name="platformInteractivity" value="5">
            <label for="interactive-5">ğŸ˜</label>
          </div>
        </div>

        <div class="rating-container">
          <label class="rating-label">4. How much have you learned from the ISLMate platform?</label>
          <div class="rating-options">
            <input type="radio" id="learned-1" name="learningOutcome" value="1" required>
            <label for="learned-1">ğŸ˜</label>
            <input type="radio" id="learned-2" name="learningOutcome" value="2">
            <label for="learned-2">ğŸ˜</label>
            <input type="radio" id="learned-3" name="learningOutcome" value="3">
            <label for="learned-3">ğŸ™‚</label>
            <input type="radio" id="learned-4" name="learningOutcome" value="4">
            <label for="learned-4">ğŸ˜Š</label>
            <input type="radio" id="learned-5" name="learningOutcome" value="5">
            <label for="learned-5">ğŸ˜</label>
          </div>
        </div>

        <div class="rating-container">
          <label class="rating-label">5. Would you recommend ISLMate to others?</label>
          <div class="rating-options">
            <input type="radio" id="recommend-1" name="recommendation" value="1" required>
            <label for="recommend-1">ğŸ˜</label>
            <input type="radio" id="recommend-2" name="recommendation" value="2">
            <label for="recommend-2">ğŸ˜</label>
            <input type="radio" id="recommend-3" name="recommendation" value="3">
            <label for="recommend-3">ğŸ™‚</label>
            <input type="radio" id="recommend-4" name="recommendation" value="4">
            <label for="recommend-4">ğŸ˜Š</label>
            <input type="radio" id="recommend-5" name="recommendation" value="5">
            <label for="recommend-5">ğŸ˜</label>
          </div>
        </div>


                <!-- Suggestions -->
                <textarea class="form-control mt-4" name="suggestions" placeholder="Any suggestions? (Optional)"></textarea>
                <button type="submit" class="btn btn-primary mt-3">Submit Feedback</button>
              </form>
            </section>
          </main>

          <!-- Popup and Overlay -->
          <div class="overlay"></div>
          <div class="popup" id="student-popup">
            <div class="popup-header">
              <h4>Have you submitted the feedback?</h4>
              <span class="close-btn">&times;</span>
            </div>
            <div class="popup-buttons">
              <button id="yes-btn" class="btn btn-success">YES</button>
              <button id="no-btn" class="btn btn-danger">NO</button>
            </div>
          </div>

  <canvas id="confetti" class="confetti"></canvas>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up-short"></i>
  </a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Scripts -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    const studentBtn = document.getElementById('student-btn');
    const popup = document.getElementById('student-popup');
    const overlay = document.querySelector('.overlay');
    const closeBtn = document.querySelector('.close-btn');
    const yesBtn = document.getElementById('yes-btn');
    const noBtn = document.getElementById('no-btn');

    studentBtn.addEventListener('click', (e) => {
      e.preventDefault();
      popup.style.display = 'block';
      overlay.style.display = 'block';
    });

    closeBtn.addEventListener('click', () => closePopup());
    noBtn.addEventListener('click', () => alert('Please complete the feedback form before proceeding!'));
    yesBtn.addEventListener('click', () => {
      closePopup();
      launchConfetti();
    });

    function closePopup() {
      popup.style.display = 'none';
      overlay.style.display = 'none';
    }

    // Confetti launch function
  function launchConfetti(duration = 4000) {
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;

    const particles = Array.from({ length: 100 }, () => ({
      x: Math.random() * confettiCanvas.width,
      y: Math.random() * confettiCanvas.height,
      radius: Math.random() * 5 + 2,
      color: `hsl(${Math.random() * 360}, 70%, 50%)`,
      dx: Math.random() * 4 - 2,
      dy: Math.random() * 4 - 2,
    }));

    let startTime = null;
    function animate(timestamp) {
      if (!startTime) startTime = timestamp;
      const elapsed = timestamp - startTime;

      if (elapsed < duration) {
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        particles.forEach((p) => {
          p.x += p.dx;
          p.y += p.dy;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          ctx.fillStyle = p.color;
          ctx.fill();
        });
        requestAnimationFrame(animate);
      }
    }
    requestAnimationFrame(animate);
  }

  // Feedback form submission logic
  document.getElementById('feedback-form').addEventListener('submit', async function (e) {
  e.preventDefault(); // Prevent default form submission

  // Gather all form data, including hidden fields
  const formData = new FormData(this); 
  const payload = {};

  // Convert formData to a JSON object
  formData.forEach((value, key) => {
    payload[key] = value; // Add each key-value pair from the form
  });

  // Debugging: Log the payload to verify
  console.log("Payload to be sent:", payload);

  // Send data to the backend
  try {
    const response = await fetch('http://localhost:8080/api/email/feedback/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (response.ok) {
        // Launch confetti for 4 seconds, then redirect
        launchConfetti(4000);
        setTimeout(() => {
          window.location.href = 'student.html';
        }, 4000);
      } else {
        alert('Error submitting feedback.');
      }
    } catch (err) {
      console.error('Submission failed:', err);
      alert('Submission failed. Please try again.');
    }
  });

  // Function to show the exit popup
function showExitPopup(targetUrl) {
  const popup = document.getElementById('student-popup');
  const overlay = document.querySelector('.overlay');

  popup.style.display = 'block';
  overlay.style.display = 'block';

  // Handle "Yes" and "No" actions dynamically
  document.getElementById('yes-btn').onclick = () => {
    closePopup();
    launchConfetti(3000);
    setTimeout(() => {
      window.location.href = targetUrl; // Redirect to the desired URL
    }, 3000);
  };

  document.getElementById('no-btn').onclick = () => {
    closePopup();
    window.location.href = 'learningFeedback.html'; // Redirect to feedback form
  };
}

// Function to close the popup
function closePopup() {
  const popup = document.getElementById('student-popup');
  const overlay = document.querySelector('.overlay');

  popup.style.display = 'none';
  overlay.style.display = 'none';
}

// Confetti launch function
function launchConfetti(duration = 4000) {
  const confettiCanvas = document.getElementById('confetti');
  const ctx = confettiCanvas.getContext('2d');
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;

  const particles = Array.from({ length: 100 }, () => ({
    x: Math.random() * confettiCanvas.width,
    y: Math.random() * confettiCanvas.height,
    radius: Math.random() * 5 + 2,
    color: `hsl(${Math.random() * 360}, 70%, 50%)`,
    dx: Math.random() * 4 - 2,
    dy: Math.random() * 4 - 2,
  }));

  let startTime = null;
  function animate(timestamp) {
    if (!startTime) startTime = timestamp;
    const elapsed = timestamp - startTime;

    if (elapsed < duration) {
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      particles.forEach((p) => {
        p.x += p.dx;
        p.y += p.dy;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
      });
      requestAnimationFrame(animate);
    }
  }
  requestAnimationFrame(animate);
}

// Attach click event listeners to navigation links
document.querySelectorAll('a').forEach((link) => {
  link.addEventListener('click', (event) => {
    const targetUrl = link.href;

    // Prevent navigation and show the popup if leaving the current page
    if (targetUrl && !targetUrl.includes('student.html') && !targetUrl.includes('#')) {
      event.preventDefault();
      showExitPopup(targetUrl); // Pass the target URL to the popup handler
    }
  });
});

// Feedback form submission logic
document.getElementById('feedback-form').addEventListener('submit', async function (e) {
  e.preventDefault(); // Prevent default form submission

  // Gather all form data, including hidden fields
  const formData = new FormData(this);
  const payload = {};

  // Convert formData to a JSON object
  formData.forEach((value, key) => {
    payload[key] = value;
  });

  console.log('Payload to be sent:', payload); // Debugging payload

  try {
    const response = await fetch('http://localhost:8080/api/email/feedback/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    if (response.ok) {
      // Launch confetti for 4 seconds, then redirect
      launchConfetti(4000);
      setTimeout(() => {
        window.location.href = 'student.html';
      }, 4000);
    } else {
      alert('Error submitting feedback.');
    }
  } catch (err) {
    console.error('Submission failed:', err);
    alert('Submission failed. Please try again.');
  }
});
  </script>
</body>

</html>
